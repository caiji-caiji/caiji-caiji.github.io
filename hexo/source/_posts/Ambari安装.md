﻿﻿# Ambari安装与配置### 1.Ambari简介## Apache Ambari项目旨在通过开发用于配置，管理和监视Apache Hadoop集群的软件来简化Hadoop管理。Ambari通过其RESTful API（REpresentational State Transfer，代表着分布式服务的架构风格。）提供了直观，易于使用的Hadoop管理Web UI。### 2.Ambari功能1. 设置Hadoop集群  2.  Ambari提供了用于在任意数量的主机上安装Hadoop服务的分步向导。  2.  Ambari处理群集的Hadoop服务的配置。2. 管理Hadoop集群  1.  Ambari提供了用于在整个集群中启动，停止和重新配置Hadoop服务的集中管理。3. 监控Hadoop集群  1.  Ambari提供了一个仪表板，用于监视Hadoop集群的运行状况和状态。  2.  Ambari利用指标系统（Ambari Metrics System）收集指标。  3.  Ambari利用告警框架（Ambari Alert Framework）进行系统警报，并在需要您关注时（例如，节点故障，剩余磁盘空间不足等）通知您。4. Ambari使应用程序开发人员和系统集成商能够使用Ambari REST API轻松将Hadoop的配置，管理和监视功能集成到自己的应用程序中。### 3.Ambari安装准备>1.配置SSH免密码登录>3.创建ambari系统用户和用户组>只在主节点操作,添加ambari安装、运行用户和用户组，也可以不创建新用户，直接使用root或者系统其他账号    adduser ambari     passwd ambari>4.开启NTP服务(所有节点)    yum install ntp     systemctl is-enabled ntpd (激活NTP服务)    systemctl enable ntpd     systemctl start ntpd (启动NTP服务)>5.检查DNS和NSCD(所有节点)>NSCD(Name Service Cache Daemon)是一种能够缓存 passwd、group、hosts 的本地缓存服务,最为明显的作用就是加快 DNS 解析速度.    vi /etc/hosts     192.168.63.4 master.hadoop master    192.168.63.5 slave1.hadoop slave1    192.168.63.6 slave2.hadoop slave2    192.168.63.7 slave3.hadoop slave3>每台节点里配置FQDN，如下以主节点为例(要注意FQDN的命名规范:hostname+域名)>NETWORKING=yes为启动时激活联网>FQDN：(Fully Qualified Domain Name)全限定域名    vi /etc/sysconfig/network-scripts/ifcfg-ens33    NETWORKING=yes    HOSTNAME=master.hadoop>6.关闭防火墙    systemctl disable firewalld     systemctl stop firewalld>7.关闭所有节点的SELinux    >安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统>查看SELinux状态：    sestatus>如果SELinuxstatus参数为enabled即为开启状态 SELinux status: enabled>修改配置文件    vi /etc/sysconfig/selinux    SELINUX=disabled>SELinux 有三种工作模式，分别是：>1. enforcing：强制模式。违反 SELinux 规则的行为将被阻止并记录到日志中。>2. permissive：宽容模式。违反 SELinux 规则的行为只会记录到日志中。一般为调试用。>3. disabled：关闭 SELinux。>修改文件打开限制    vi /etc/security/limits.conf>在文件描述符文件末尾添加下列代码    * soft nofile 65536       #  可打开的文件描述符的最大数(软限制)    * hard nofile 65536       #  可打开的文件描述符的最大数(硬限制)    * soft nproc 131072       #  单个用户可用的最大进程数量(软限制)    * hard nproc 131072       #  单个用户可用的最大进程数量(硬限制)>8.安装HTTP服务安装HTTP服务器，允许 http 服务通过防火墙(永久)    yum install httpd     firewall-cmd --add-service=http     firewall-cmd --permanent --add-service=http>添加Apache 服务到系统层使其随系统自动启动    systemctl start httpd.service    systemctl enable httpd.service>9.将下载的三个包放到/var/www/html目录下并且解压    cd /var/www/html    mkdir ambari    tar -zxvf ambari-2.6.0.0-centos7.tar.gz    tar -zxvf HDP-2.6.3.0-centos7-rpm.tar.gz     mkdir HDP-UTILS    tar -zxvf HDP-UTILS-1.1.0.21-centos7.tar.gz -C HDP-UTILS    ls>现在可以通过访问http://192.168.63.4/ambari/查看是否能成功访问>10.安装本地源制作相关工具(createrepo是linux下的创建仓库的软件包。)    yum install yum-utils createrepo    createrepo  ./>11.修改文件里面的源地址>修改ambari文件    vi ambari/centos7/2.6.0.0-267/ambari.repo    #VERSION_NUMBER=2.6.0.0-267    [ambari-2.6.0.0]    name=ambari Version - ambari-2.6.0.0    baseurl=http://192.168.63.4/ambari/ambari/centos7/2.6.0.0-267    gpgcheck=1    gpgkey=http://192.168.63.4/ambari/ambari/centos7/2.6.0.0-267/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins    enabled=1    priority=1>修改成功后将该文件备份       cp ambari/centos7/2.6.0.0-267/ambari.repo /etc/yum.repos.d/  >修改HDP文件    vi HDP/centos7/2.6.3.0-235/hdp.repo    #VERSION_NUMBER=2.6.3.0-235    [HDP-2.6.3.0]    name=HDP Version - HDP-2.6.3.0    baseurl=http://192.168.63.4/ambari/HDP/centos7/2.6.3.0-235    gpgcheck=1    gpgkey=http://192.168.63.4/ambari/HDP/centos7/2.6.3.0-235/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins    enabled=1    priority=1            [HDP-UTILS-1.1.0.21]    name=HDP-UTILS Version - HDP-UTILS-1.1.0.21    baseurl=http://192.168.63.4/ambari/HDP-UTILS    gpgcheck=1    gpgkey=http://192.168.63.4/ambari/HDP-UTILS/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins    enabled=1    priority=1    >修改成功后将该文件备份    cp HDP/centos7/2.6.3.0-235/hdp.repo /etc/yum.repos.d/>上面创建好了主机上的文件，然后可以通过下面命令清楚一下yum的缓存就可以了    yum clean all    #清除yum缓存,yum会把下载的软件包和header存储在cache中，而不自动删除。    yum makecache    #就是把服务器的包信息下载到本地电脑缓存起来    yum repolist     #查看（开启的）资源库。>12.将创建好的文件拷贝到子节点    cd /etc/yum.repos.d    scp ambari.repo slave1:/etc/yum.repos.d/ambari.repo    scp ambari.repo slave2:/etc/yum.repos.d/ambari.repo    scp ambari.repo slave3:/etc/yum.repos.d/ambari.repo    scp hdp.repo slave1:/etc/yum.repos.d/hdp.repo    scp hdp.repo slave2:/etc/yum.repos.d/hdp.repo    scp hdp.repo slave3:/etc/yum.repos.d/hdp.repo### 4.安装ambari-server>有两种模式，一种是默认postgresql数据库的安装方式，这种不推荐生产环境使用，还有一种方式是使用第三方数据库的安装方式>1.默认安装方式，使用默认数据库PostgreSQL>安装和配置ambari-server    yum -y install ambari-server    ambari-server setup>2.启动ambari    ambari-server start>成功启动后在浏览器输入Ambari地址：http://192.168.63.4:8080